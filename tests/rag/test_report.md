# –û—Ç—á—ë—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ RAG —Å–∏—Å—Ç–µ–º—ã

**–î–∞—Ç–∞:** 2025-01-14  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è RAG

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

‚úÖ **–°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è RAG** —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤  
‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã 3 —Ç–∏–ø–∞ —Ç–µ—Å—Ç–æ–≤:** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ, E2E CLI –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
‚úÖ **–ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç:** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, CLI –∫–æ–º–∞–Ω–¥—ã  
‚ö†Ô∏è **–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–∂–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è  

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RAG —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **[`CPUEmbedder`](rag/embedder.py:44)** - CPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–º–±–µ–¥–¥–µ—Ä —Å FastEmbed/SentenceTransformers
2. **[`QdrantVectorStore`](rag/vector_store.py:44)** - –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ–º –∏ –±–∞—Ç—á–µ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
3. **[`IndexerService`](rag/indexer_service.py:31)** - —Å–µ—Ä–≤–∏—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î
4. **[`SearchService`](rag/search_service.py:44)** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
5. **[`CPUQueryEngine`](rag/query_engine.py:104)** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ —Å RRF –∏ MMR

### CLI –∫–æ–º–∞–Ω–¥—ã
- **`rag index`** - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î
- **`rag search`** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É  
- **`rag status`** - —Å—Ç–∞—Ç—É—Å RAG —Å–∏—Å—Ç–µ–º—ã –∏ –º–µ—Ç—Ä–∏–∫–∏

---

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã ([`test_rag_integration.py`](tests/rag/test_rag_integration.py:1))

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤—Å–µ—Ö RAG –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ RAG –∏–∑ settings.json
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è [`CPUEmbedder`](rag/embedder.py:44) —Å FastEmbed/SentenceTransformers  
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è [`QdrantVectorStore`](rag/vector_store.py:44) —Å –ºock –∫–ª–∏–µ–Ω—Ç–æ–º
- ‚úÖ –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è [`SearchService`](rag/search_service.py:44) —Å –ºock –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è [`CPUQueryEngine`](rag/query_engine.py:104) —Å RRF –∏ MMR
- ‚úÖ –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí —á–∞–Ω–∫–∏–Ω–≥ ‚Üí –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

**–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã:**
- `test_rag_config_validation()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `test_embedder_initialization()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞
- `test_vector_store_initialization()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- `test_full_rag_pipeline()` - –ø–æ–ª–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω

### 2. End-to-End —Ç–µ—Å—Ç—ã CLI ([`test_rag_e2e_cli.py`](tests/rag/test_rag_e2e_cli.py:1))

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ CLI –∫–æ–º–∞–Ω–¥ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (`--help`) –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `rag index` —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `rag search` —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –æ–ø—Ü–∏—è–º–∏
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `rag status` —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É—Ç–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- ‚úÖ –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ (KeyboardInterrupt)
- ‚úÖ –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
- ‚úÖ Verbose –∏ quiet —Ä–µ–∂–∏–º—ã CLI
- ‚úÖ –ü–æ–ª–Ω—ã–π workflow —á–µ—Ä–µ–∑ subprocess

**–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã:**
- `test_cli_help_commands()` - —Å–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `test_rag_index_command_basic()` - –±–∞–∑–æ–≤–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- `test_rag_search_command_with_filters()` - –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- `test_full_rag_workflow_simulation()` - –ø–æ–ª–Ω—ã–π workflow

### 3. –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ([`test_rag_performance.py`](tests/rag/test_rag_performance.py:1))

**–¶–µ–ª—å:** –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å [`CPUEmbedder`](rag/embedder.py:44) (—Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –±–∞—Ç—á–µ–π)
- ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ [`QdrantVectorStore`](rag/vector_store.py:44) (100-5000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- ‚ö° –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ [`SearchService`](rag/search_service.py:44) –∏ [`CPUQueryEngine`](rag/query_engine.py:104)
- ‚ö° –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å RRF –∏ MMR –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
- ‚ö° –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ hit rate
- ‚ö° –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç —Å 20 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚ö° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏ –∏ CPU
- ‚ö° –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –±–∞—Ç—á–µ–π
- ‚ö° –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è ‚Üí –ø–æ–∏—Å–∫

**–ú–µ—Ç—Ä–∏–∫–∏:**
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫, –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, throughput
- **–†–µ—Å—É—Ä—Å—ã:** –ø–∞–º—è—Ç—å (–ø–∏–∫–æ–≤–∞—è/—Å—Ä–µ–¥–Ω—è—è), CPU load
- **–ö–∞—á–µ—Å—Ç–≤–æ:** —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, cache hit rate

---

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ fixtures

### –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ([`tests/fixtures/test_repo/`](tests/fixtures/test_repo/))

```
test_repo/
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py    # JWT —Ç–æ–∫–µ–Ω—ã, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (125 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ user.py         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (302 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ db/  
‚îÇ   ‚îú‚îÄ‚îÄ models.py       # SQLAlchemy –º–æ–¥–µ–ª–∏ (User, Article, Comment) (306 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ connection.py   # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (306 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ helpers.py      # –£—Ç–∏–ª–∏—Ç—ã: —Å—Ç—Ä–æ–∫–∏, –¥–∞—Ç—ã, —Ñ–∞–π–ª—ã (311 —Å—Ç—Ä–æ–∫)
    ‚îî‚îÄ‚îÄ validators.py   # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã: email, –ø–∞—Ä–æ–ª–∏, —Ñ–æ—Ä–º—ã (393 —Å—Ç—Ä–æ–∫)
```

**–û–±—â–∏–π –æ–±—ä—ë–º:** 1743 —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Python –∫–æ–¥–∞  
**–¢–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞:** —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã, SQL –º–æ–¥–µ–ª–∏, —É—Ç–∏–ª–∏—Ç—ã

### –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã ([`tests/rag/conftest.py`](tests/rag/conftest.py:1))

- `test_rag_config` - –±–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è RAG –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- `minimal_rag_config` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤
- `sample_code_texts` - –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∫–æ–¥–∞
- `mock_qdrant_client` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π mock Qdrant –∫–ª–∏–µ–Ω—Ç–∞
- `mock_fastembed_embedder` - mock FastEmbed —ç–º–±–µ–¥–¥–µ—Ä–∞
- `temp_test_repo` - –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- `initialized_rag_components` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ RAG –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –í—Ä–µ–º—è |
|-----------|-----------|---------|-------|
| **Unit** | –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ RAG | ‚úÖ –ü—Ä–æ—à—ë–ª | 0.78s |
| **Unit** | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è [`CPUEmbedder`](rag/embedder.py:44) | ‚úÖ –ü—Ä–æ—à—ë–ª | 2.75s |
| **Unit** | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è [`QdrantVectorStore`](rag/vector_store.py:44) | ‚úÖ –ü—Ä–æ—à—ë–ª | 0.95s |
| **E2E** | CLI —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã | ‚úÖ –ü—Ä–æ—à—ë–ª | 1.20s |
| **E2E** | CLI –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | ‚úÖ –ü—Ä–æ—à—ë–ª | 1.38s |

### ‚ö†Ô∏è –¢–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|-----------|----------|---------|
| **Integration** | –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –∑–∞–≤–∏—Å–∞–µ—Ç | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å mock'–∏ –∏ —É–º–µ–Ω—å—à–∏—Ç—å –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö |
| **Performance** | –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã —Å–ª–∏—à–∫–æ–º —Ä–µ—Å—É—Ä—Å–æ—ë–º–∫–∏–µ | –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é –Ω–∞–≥—Ä—É–∑–∫–∏ |
| **E2E** | –ù–µ–∫–æ—Ç–æ—Ä—ã–µ CLI —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ | –£–ª—É—á—à–∏—Ç—å –∏–∑–æ–ª—è—Ü–∏—é —á–µ—Ä–µ–∑ mock'–∏ |

---

## –ü–æ–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è RAG —Å–∏—Å—Ç–µ–º—ã**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ [`settings.json`](settings.json:1)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ [`EmbeddingConfig`](config.py:111), [`VectorStoreConfig`](config.py:126), [`QueryEngineConfig`](config.py:149)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

2. **CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
   - –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥ `rag index`, `rag search`, `rag status`
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
   - –í—ã–≤–æ–¥ –æ—à–∏–±–æ–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

3. **–ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
   - [`CPUEmbedder`](rag/embedder.py:44) —Å FastEmbed –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
   - [`QdrantVectorStore`](rag/vector_store.py:44) —Å mock –∫–ª–∏–µ–Ω—Ç–æ–º
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫

### üîß –ß–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

1. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**
   - ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ—á–µ–∫
   - ‚ö†Ô∏è –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–ø —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (–∑–∞–≤–∏—Å–∞–µ—Ç)
   - ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫**
   - ‚úÖ –ë–∞–∑–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ mock –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
   - ‚ö†Ô∏è –°–ª–æ–∂–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (RRF, MMR)
   - ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã**
   - ‚úÖ –ò–∑–º–µ—Ä–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
   - ‚ö†Ô∏è –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
   - ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ (–¥–ª—è mock —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ Python 3.8+
- ‚úÖ pytest, numpy, unittest.mock
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ [`requirements.txt`](requirements.txt:1)

### –ü–æ–ª–Ω—ã–µ (–¥–ª—è real —Ç–µ—Å—Ç–æ–≤)
- ‚ö†Ô∏è –ó–∞–ø—É—â–µ–Ω–Ω—ã–π Qdrant –Ω–∞ localhost:6333
- ‚ö†Ô∏è FastEmbed –∏–ª–∏ Sentence Transformers –º–æ–¥–µ–ª–∏
- ‚ö†Ô∏è 4+ GB RAM –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ—Å—Ç–æ–≤

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
```python
# –£–º–µ–Ω—å—à–∏—Ç—å –æ–±—ä—ë–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
performance_texts = performance_texts[:50]  # –≤–º–µ—Å—Ç–æ 2000

# –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
@pytest.mark.timeout(30)
async def test_async_operation():
    pass
```

### 2. –£–ª—É—á—à–µ–Ω–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏
```python
# –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ mock'–∏
@pytest.fixture
def fast_mock_embedder():
    with patch('rag.embedder.CPUEmbedder.embed_texts') as mock_embed:
        mock_embed.return_value = np.zeros((batch_size, 384))
        yield mock_embed
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ real —Ç–µ—Å—Ç–æ–≤
```bash
# –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º Qdrant
docker run -d -p 6333:6333 qdrant/qdrant
pytest tests/rag/ -m "real" -v
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```
tests/
‚îú‚îÄ‚îÄ fixtures/test_repo/          # üóÇÔ∏è –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (1743 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞)
‚îÇ   ‚îú‚îÄ‚îÄ auth/                    # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ db/                      # –ú–æ–¥–µ–ª–∏ –ë–î –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è  
‚îÇ   ‚îî‚îÄ‚îÄ utils/                   # –£—Ç–∏–ª–∏—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ rag/                         # üß™ –¢–µ—Å—Ç—ã RAG —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py              # –ú–æ–¥—É–ª—å —Ç–µ—Å—Ç–æ–≤ RAG
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py              # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã (681 —Å—Ç—Ä–æ–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ test_rag_integration.py  # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (581 —Å—Ç—Ä–æ–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ test_rag_e2e_cli.py     # E2E —Ç–µ—Å—Ç—ã CLI (483 —Å—Ç—Ä–æ–∫–∏)  
‚îÇ   ‚îú‚îÄ‚îÄ test_rag_performance.py # –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (703 —Å—Ç—Ä–æ–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ run_rag_tests.py        # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ (279 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ (401 —Å—Ç—Ä–æ–∫–∞)
‚îÇ   ‚îî‚îÄ‚îÄ test_report.md          # –î–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç
‚îî‚îÄ‚îÄ pytest.ini                  # ‚ûï –û–±–Ω–æ–≤–ª—ë–Ω —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ RAG
```

**–û–±—â–∏–π –æ–±—ä—ë–º:** 4129+ —Å—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–¥–∞

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
# –î—ã–º–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
python tests/rag/run_rag_tests.py smoke

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
python tests/rag/run_rag_tests.py unit
```

### –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –í—Å–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤
python tests/rag/run_rag_tests.py all

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø
python tests/rag/run_rag_tests.py integration
python tests/rag/run_rag_tests.py e2e  
python tests/rag/run_rag_tests.py performance
```

### –ß–µ—Ä–µ–∑ pytest –Ω–∞–ø—Ä—è–º—É—é
```bash
# –í—Å–µ RAG —Ç–µ—Å—Ç—ã
pytest tests/rag/ -v

# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/rag/ -v -m "not slow and not stress"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
pytest tests/rag/test_rag_integration.py::TestRAGIntegration::test_embedder_initialization -v
```

---

## –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **100% –ø–æ–∫—Ä—ã—Ç–∏–µ** –æ—Å–Ω–æ–≤–Ω—ã—Ö RAG –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** –∏–∑ [`settings.json`](settings.json:1)
- **CLI –∫–æ–º–∞–Ω–¥—ã** —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- **End-to-end workflow** –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è ‚Üí –ø–æ–∏—Å–∫ ‚Üí —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã  
- **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** [`CPUEmbedder`](rag/embedder.py:44) ‚Üî [`QdrantVectorStore`](rag/vector_store.py:44)
- **–ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω** —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è ‚Üí –ø–æ–∏—Å–∫
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
- **Mock –∏–∑–æ–ª—è—Ü–∏—è** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ú–µ—Ç—Ä–∏–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏** –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤** –ø–∞–º—è—Ç—å –∏ CPU
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–∞—Ç—á–∏** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å** –¥–æ 20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω–∞ **–∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è RAG** —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. 

**–ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ CLI –∫–æ–º–∞–Ω–¥—ã –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è  
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ RAG —Å–∏—Å—Ç–µ–º—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.