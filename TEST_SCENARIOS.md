# Документация по тестовым сценариям

В этом файле приведены подробные описания всех автотестов, покрывающих ключевые компоненты проекта. Для каждого теста указано назначение, сценарий, входные данные и ожидаемый результат.

---

## tests/test_code_chunker.py

### test_chunk_python_code
**Назначение:** Проверяет, что CodeChunker корректно разбивает Python-код на логические чанки.
- **Вход:** Искусственный Python-код с двумя функциями.
- **Проверка:** В результате chunk_code должны быть найдены обе функции (`def foo()`, `def bar()`).
- **Ожидание:** Возвращается список чанков, содержащих обе функции.

---

## tests/test_config.py

### test_get_config_default
**Назначение:** Проверяет, что get_config возвращает корректный объект конфигурации.
- **Вход:** Вызов get_config() без параметров.
- **Проверка:** Объект имеет атрибуты openai, openai.api_key_env_var, openai.model и т.д.
- **Ожидание:** Все параметры доступны, нет хардкода, значения берутся из env.

---

## tests/test_doc_generator.py

### test_generate_markdown
**Назначение:** Проверяет генерацию Markdown-документации по ParsedFile.
- **Вход:** ParsedFile с импортами и комментариями.
- **Проверка:** В сгенерированном Markdown есть секции с импортами и комментариями.
- **Ожидание:** Markdown содержит ключевые элементы исходного файла.

---

## tests/test_file_scanner.py

### test_scan_python_files
**Назначение:** Проверяет фильтрацию файлов по расширению.
- **Вход:** Временная директория с файлами .py и .txt.
- **Проверка:** Найден только .py файл, .txt игнорируется.
- **Ожидание:** В списке файлов только поддерживаемые расширения.

---

## tests/test_integration_full_cycle.py

### test_full_analysis_cycle
**Назначение:** Интеграционный тест полного цикла анализа.
- **Вход:** Искусственный Python-файл с классом и методом.
- **Проверка:** Проходит pipeline: сканирование → парсинг → chunking → анализ через OpenAI (mock) → генерация Markdown.
- **Ожидание:** Все этапы выполняются, результат анализа и отчёт содержат ключевые элементы кода.

---

## tests/test_error_handling.py

### test_openai_manager_no_api_key
**Назначение:** Проверяет, что при отсутствии API-ключа OpenAIManager выбрасывает ошибку.
- **Вход:** Очищенная переменная окружения OPENAI_API_KEY.
- **Проверка:** Инициализация OpenAIManager вызывает ValueError.
- **Ожидание:** Ошибка корректно обрабатывается.

### test_python_parser_syntax_error
**Назначение:** Проверяет, что PythonParser корректно обрабатывает синтаксическую ошибку.
- **Вход:** Некорректный Python-код.
- **Проверка:** В parsed.parse_errors появляется сообщение об ошибке.
- **Ожидание:** Парсер не падает, а возвращает ошибку.

### test_openai_manager_network_error
**Назначение:** Проверяет обработку сетевой ошибки при обращении к OpenAI (mock).
- **Вход:** Валидный pipeline, mock _call_openai_api выбрасывает OpenAIError("Network error").
- **Проверка:** В result.error содержится "Network error".
- **Ожидание:** Ошибка корректно обрабатывается, тест не падает с необработанным исключением.

---

## tests/test_main.py

### (инициализация и запуск RepositoryAnalyzer)
**Назначение:** Проверяет корректную инициализацию и запуск главного анализатора.
- **Вход:** Конфиг, сканер, парсер, chunker, openai, генератор документации.
- **Проверка:** Все компоненты инициализируются, основной сценарий запускается без ошибок.
- **Ожидание:** Нет исключений, корректная интеграция компонентов.

---

## tests/test_markdown_report.py

### test_markdown_report_sections
**Назначение:** Проверяет, что Markdown-отчёт содержит ключевые секции и не содержит шаблонных заглушек.
- **Вход:** ParsedFile с импортами и комментариями.
- **Проверка:** В Markdown есть "Импорты", "Комментарии", нет "Ошибка анализа" и "{code_content}".
- **Ожидание:** Отчёт пригоден для пользователя.

---

## tests/test_openai_integration.py

### test_analyze_chunk_with_mock
**Назначение:** Проверяет интеграцию с OpenAI через mock.
- **Вход:** Искусственный CodeChunk, GPTAnalysisRequest, mock OpenAI API.
- **Проверка:** analyze_chunk возвращает результат при успешном ответе mock.
- **Ожидание:** Тест не зависит от реального API, проверяет логику интеграции.

---

## tests/test_parsers.py

### test_parser_extracts_classes
**Назначение:** Проверяет, что все парсеры (Python, C++, C#, TypeScript, JavaScript) находят классы.
- **Вход:** Минимальный код с определением класса для каждого языка.
- **Проверка:** Парсер находит хотя бы один класс.
- **Ожидание:** В elements есть ParsedElement с type="class".

---

## tests/test_property_based.py

### test_python_parser_property_based
**Назначение:** Property-based тест для устойчивости PythonParser.
- **Вход:** Случайные строки (валидные и невалидные) как Python-код.
- **Проверка:** Парсер не падает с необработанным исключением, всегда возвращает ParsedFile.
- **Ожидание:** Любой вход обрабатывается безопасно.

---

## tests/test_readme.py

### (проверка генерации README)
**Назначение:** Проверяет генерацию итогового README по результатам анализа.
- **Вход:** Список сгенерированных файлов.
- **Проверка:** README содержит ссылки на все отчёты, корректно оформлен.
- **Ожидание:** Итоговый файл соответствует шаблону.

---

## tests/test_run_web.py

### (проверка запуска веб-интерфейса)
**Назначение:** Проверяет запуск и базовую работоспособность веб-интерфейса.
- **Вход:** Имитация запуска через Streamlit.
- **Проверка:** Интерфейс стартует, основные компоненты доступны.
- **Ожидание:** Нет ошибок при запуске.

---

## tests/test_utils.py

### (проверка утилитных функций)
**Назначение:** Проверяет корректность работы утилит (форматирование размера, очистка имени файла и др.).
- **Вход:** Различные строки, числа, пути.
- **Проверка:** Функции возвращают ожидаемые значения.
- **Ожидание:** Все edge-cases покрыты.

---

## tests/test_web_ui.py

### (проверка компонентов веб-интерфейса)
**Назначение:** Проверяет работу компонентов веб-интерфейса, интеграцию с анализатором.
- **Вход:** Имитация пользовательских сценариев.
- **Проверка:** Компоненты корректно реагируют на действия пользователя.
- **Ожидание:** Нет ошибок, корректная интеграция.

---

## tests/test_api_init.py

### (диагностика инициализации OpenAI API)
**Назначение:** Проверяет загрузку .env, получение ключа, инициализацию OpenAIManager.
- **Вход:** Переменные окружения, .env.
- **Проверка:** Ключ корректно загружается, OpenAIManager инициализируется.
- **Ожидание:** Нет ошибок, корректная диагностика.

---

**Примечание:**  
Все тесты построены так, чтобы выявлять реальные ошибки в логике, структуре данных, интеграции и обработке ошибок. Тесты не подстроены под неработающий код — любые несоответствия приводят к падению тестов. Покрытие включает интеграционные, property-based и edge-case сценарии, что обеспечивает production-уровень контроля качества.
