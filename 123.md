Run source .venv/bin/activate
  
...........FF......F....................s............................... [ 51%]
.s.....s.................s...FE.................F........FFF.......      [100%]
==================================== ERRORS ====================================
__________________ ERROR at setup of test_basic_functionality __________________
self = <rag.embedder.CPUEmbedder object at 0x7fc1c32e14d0>
    def _initialize_model(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.info(f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º: {self.embedding_config.provider}")
    
        try:
            if self.embedding_config.provider == "fastembed" and FASTEMBED_AVAILABLE:
>               self._initialize_fastembed()
rag/embedder.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:129: in _initialize_fastembed
    self.model = TextEmbedding(
.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py:114: in __init__
    self.model = EMBEDDING_MODEL_TYPE(
.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py:251: in __init__
    self._model_dir = self.download_model(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:421: in download_model
    cls.download_files_from_huggingface(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:241: in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py:2637: in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py:96: in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:464: in _make_request
    self._validate_conn(conn)
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:1093: in _validate_conn
    conn.connect()
.venv/lib/python3.11/site-packages/urllib3/connection.py:753: in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.11/site-packages/urllib3/util/connection.py:64: in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cls = <class 'pytest_socket.disable_socket.<locals>.GuardedSocket'>
family = <AddressFamily.AF_INET: 2>, type = <SocketKind.SOCK_STREAM: 1>
proto = 6, fileno = None
    def __new__(cls, family=-1, type=-1, proto=-1, fileno=None):
        if _is_unix_socket(family) and allow_unix_socket:
            return super().__new__(cls, family, type, proto, fileno)
    
>       raise SocketBlockedError()
E       pytest_socket.SocketBlockedError: A test tried to use socket.socket.
.venv/lib/python3.11/site-packages/pytest_socket.py:89: SocketBlockedError
During handling of the above exception, another exception occurred:
    @pytest.fixture
    def query_engine():
        """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è CPUQueryEngine"""
        from rag import CPUEmbedder, QdrantVectorStore
        from rag.query_engine import CPUQueryEngine
        from config import get_config
    
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        config = get_config(require_api_key=False)
    
        # –°–æ–∑–¥–∞—ë–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É Qdrant)
>       embedder = CPUEmbedder(
            config.rag.embeddings,
            config.rag.parallelism
        )
tests/test_cpu_query_engine.py:35: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:91: in __init__
    self._initialize_model()
rag/embedder.py:118: in _initialize_model
    self._try_fallback_initialization()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <rag.embedder.CPUEmbedder object at 0x7fc1c32e14d0>
    def _try_fallback_initialization(self) -> None:
        """–ü–æ–ø—ã—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.warning("–ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é")
    
>       if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
           ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
rag/embedder.py:177: AttributeError
------------------------------ Captured log setup ------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
=================================== FAILURES ===================================
______________ TestRAGCliE2E.test_rag_commands_keyboard_interrupt ______________
self = <tests.rag.test_rag_e2e_cli.TestRAGCliE2E object at 0x7fc1c9f9ded0>
runner = <click.testing.CliRunner object at 0x7fc307d44e10>
temp_settings_file = '/tmp/tmp45a8qh4f.json'
    def test_rag_commands_keyboard_interrupt(self, runner, temp_settings_file):
        """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥ (Ctrl+C)"""
        # –°–∏–º—É–ª–∏—Ä—É–µ–º KeyboardInterrupt
        with patch('rag.indexer_service.IndexerService.index_repository') as mock_index:
            mock_index.side_effect = KeyboardInterrupt()
    
            result = runner.invoke(cli, [
                '--config', temp_settings_file,
                'rag', 'index', temp_settings_file,
                '--no-progress'
            ])
    
            assert result.exit_code == 1
>           assert '–ø—Ä–µ—Ä–≤–∞–Ω' in result.output.lower() or 'interrupt' in result.output.lower()
E           assert ('–ø—Ä–µ—Ä–≤–∞–Ω' in "üîÑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nqdrant: localhost:6333\n–∫–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'cpuembedder' object has no attribute 'provider_name'\n" or 'interrupt' in "üîÑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nqdrant: localhost:6333\n–∫–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'cpuembedder' object has no attribute 'provider_name'\n")
E            +  where "üîÑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nqdrant: localhost:6333\n–∫–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'cpuembedder' object has no attribute 'provider_name'\n" = <built-in method lower of str object at 0x56349741cc80>()
E            +    where <built-in method lower of str object at 0x56349741cc80> = "üîÑ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nQdrant: localhost:6333\n–ö–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'CPUEmbedder' object has no attribute 'provider_name'\n".lower
E            +      where "üîÑ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nQdrant: localhost:6333\n–ö–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'CPUEmbedder' object has no attribute 'provider_name'\n" = <Result SystemExit(1)>.output
E            +  and   "üîÑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nqdrant: localhost:6333\n–∫–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'cpuembedder' object has no attribute 'provider_name'\n" = <built-in method lower of str object at 0x5634a49e9850>()
E            +    where <built-in method lower of str object at 0x5634a49e9850> = "üîÑ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nQdrant: localhost:6333\n–ö–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'CPUEmbedder' object has no attribute 'provider_name'\n".lower
E            +      where "üîÑ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nQdrant: localhost:6333\n–ö–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'CPUEmbedder' object has no attribute 'provider_name'\n" = <Result SystemExit(1)>.output
tests/rag/test_rag_e2e_cli.py:419: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
ERROR    main:main.py:567 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏: 'CPUEmbedder' object has no attribute 'provider_name'
Traceback (most recent call last):
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 99, in _initialize_model
    self._initialize_fastembed()
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 129, in _initialize_fastembed
    self.model = TextEmbedding(
                 ^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py", line 114, in __init__
    self.model = EMBEDDING_MODEL_TYPE(
                 ^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py", line 251, in __init__
    self._model_dir = self.download_model(
                      ^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/fastembed/common/model_management.py", line 421, in download_model
    cls.download_files_from_huggingface(
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/fastembed/common/model_management.py", line 241, in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py", line 2637, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 96, in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/requests/adapters.py", line 667, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/util/connection.py", line 64, in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/pytest_socket.py", line 89, in __new__
    raise SocketBlockedError()
pytest_socket.SocketBlockedError: A test tried to use socket.socket.
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "/home/runner/work/repo_sum/repo_sum/main.py", line 525, in index
    indexer = IndexerService(config)
              ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/rag/indexer_service.py", line 58, in __init__
    self.embedder = CPUEmbedder(config.rag.embeddings, config.rag.parallelism)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 91, in __init__
    self._initialize_model()
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 118, in _initialize_model
    self._try_fallback_initialization()
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 177, in _try_fallback_initialization
    if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
       ^^^^^^^^^^^^^^^^^^
AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
______________ TestRAGCliE2E.test_rag_commands_connection_errors _______________
self = <tests.rag.test_rag_e2e_cli.TestRAGCliE2E object at 0x7fc1c9f9e5d0>
runner = <click.testing.CliRunner object at 0x7fc1c9b02a90>
temp_settings_file = '/tmp/tmpr8hx__xo.json'
    def test_rag_commands_connection_errors(self, runner, temp_settings_file):
        """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Qdrant"""
        # –°–∏–º—É–ª–∏—Ä—É–µ–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Qdrant (—Ä–µ–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π –≤ CI/CD)
        with patch('rag.vector_store.QdrantClient') as mock_client_class:
            mock_client_class.side_effect = ConnectionError("Connection refused")
    
            # –¢–µ—Å—Ç–∏—Ä—É–µ–º index –∫–æ–º–∞–Ω–¥—É
            result = runner.invoke(cli, [
                '--config', temp_settings_file,
                'rag', 'index', temp_settings_file,
                '--no-progress'
            ])
    
            assert result.exit_code == 1
>           assert any(error_msg in result.output for error_msg in [
                '–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ qdrant',
                'connection',
                'refused'
            ])
E           assert False
E            +  where False = any(<generator object TestRAGCliE2E.test_rag_commands_connection_errors.<locals>.<genexpr> at 0x7fc1c9996420>)
tests/rag/test_rag_e2e_cli.py:435: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
ERROR    main:main.py:567 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏: 'CPUEmbedder' object has no attribute 'provider_name'
Traceback (most recent call last):
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 99, in _initialize_model
    self._initialize_fastembed()
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 129, in _initialize_fastembed
    self.model = TextEmbedding(
                 ^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py", line 114, in __init__
    self.model = EMBEDDING_MODEL_TYPE(
                 ^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py", line 251, in __init__
    self._model_dir = self.download_model(
                      ^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/fastembed/common/model_management.py", line 421, in download_model
    cls.download_files_from_huggingface(
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/fastembed/common/model_management.py", line 241, in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py", line 2637, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py", line 96, in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/requests/adapters.py", line 667, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/urllib3/util/connection.py", line 64, in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/.venv/lib/python3.11/site-packages/pytest_socket.py", line 89, in __new__
    raise SocketBlockedError()
pytest_socket.SocketBlockedError: A test tried to use socket.socket.
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "/home/runner/work/repo_sum/repo_sum/main.py", line 525, in index
    indexer = IndexerService(config)
              ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/rag/indexer_service.py", line 58, in __init__
    self.embedder = CPUEmbedder(config.rag.embeddings, config.rag.parallelism)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 91, in __init__
    self._initialize_model()
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 118, in _initialize_model
    self._try_fallback_initialization()
  File "/home/runner/work/repo_sum/repo_sum/rag/embedder.py", line 177, in _try_fallback_initialization
    if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
       ^^^^^^^^^^^^^^^^^^
AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
_______________ TestRAGIntegration.test_embedder_initialization ________________
self = <rag.embedder.CPUEmbedder object at 0x7fc1c9ec7fd0>
    def _initialize_model(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.info(f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º: {self.embedding_config.provider}")
    
        try:
            if self.embedding_config.provider == "fastembed" and FASTEMBED_AVAILABLE:
>               self._initialize_fastembed()
rag/embedder.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:129: in _initialize_fastembed
    self.model = TextEmbedding(
.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py:114: in __init__
    self.model = EMBEDDING_MODEL_TYPE(
.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py:251: in __init__
    self._model_dir = self.download_model(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:421: in download_model
    cls.download_files_from_huggingface(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:241: in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py:2637: in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py:96: in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:464: in _make_request
    self._validate_conn(conn)
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:1093: in _validate_conn
    conn.connect()
.venv/lib/python3.11/site-packages/urllib3/connection.py:753: in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.11/site-packages/urllib3/util/connection.py:64: in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cls = <class 'pytest_socket.disable_socket.<locals>.GuardedSocket'>
family = <AddressFamily.AF_INET: 2>, type = <SocketKind.SOCK_STREAM: 1>
proto = 6, fileno = None
    def __new__(cls, family=-1, type=-1, proto=-1, fileno=None):
        if _is_unix_socket(family) and allow_unix_socket:
            return super().__new__(cls, family, type, proto, fileno)
    
>       raise SocketBlockedError()
E       pytest_socket.SocketBlockedError: A test tried to use socket.socket.
.venv/lib/python3.11/site-packages/pytest_socket.py:89: SocketBlockedError
During handling of the above exception, another exception occurred:
self = <tests.rag.test_rag_integration.TestRAGIntegration object at 0x7fc1c9c1c190>
test_config = Config(openai=<Mock id='140470293129808'>, token_management=<Mock id='140470293132368'>, analysis=<Mock id='1404702931...workers=4, embed_workers=4), parallelism=ParallelismConfig(torch_num_threads=2, omp_num_threads=2, mkl_num_threads=2)))
    def test_embedder_initialization(self, test_config):
        """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —ç–º–±–µ–¥–¥–µ—Ä–∞"""
>       embedder = CPUEmbedder(
            test_config.rag.embeddings,
            test_config.rag.parallelism
        )
tests/rag/test_rag_integration.py:158: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:91: in __init__
    self._initialize_model()
rag/embedder.py:118: in _initialize_model
    self._try_fallback_initialization()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <rag.embedder.CPUEmbedder object at 0x7fc1c9ec7fd0>
    def _try_fallback_initialization(self) -> None:
        """–ü–æ–ø—ã—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.warning("–ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é")
    
>       if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
           ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
rag/embedder.py:177: AttributeError
------------------------------ Captured log call -------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
__________________________ test_basic_initialization ___________________________
self = <rag.embedder.CPUEmbedder object at 0x7fc1c9bc8d10>
    def _initialize_model(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.info(f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º: {self.embedding_config.provider}")
    
        try:
            if self.embedding_config.provider == "fastembed" and FASTEMBED_AVAILABLE:
>               self._initialize_fastembed()
rag/embedder.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:129: in _initialize_fastembed
    self.model = TextEmbedding(
.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py:114: in __init__
    self.model = EMBEDDING_MODEL_TYPE(
.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py:251: in __init__
    self._model_dir = self.download_model(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:421: in download_model
    cls.download_files_from_huggingface(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:241: in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py:2637: in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py:96: in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:464: in _make_request
    self._validate_conn(conn)
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:1093: in _validate_conn
    conn.connect()
.venv/lib/python3.11/site-packages/urllib3/connection.py:753: in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.11/site-packages/urllib3/util/connection.py:64: in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cls = <class 'pytest_socket.disable_socket.<locals>.GuardedSocket'>
family = <AddressFamily.AF_INET: 2>, type = <SocketKind.SOCK_STREAM: 1>
proto = 6, fileno = None
    def __new__(cls, family=-1, type=-1, proto=-1, fileno=None):
        if _is_unix_socket(family) and allow_unix_socket:
            return super().__new__(cls, family, type, proto, fileno)
    
>       raise SocketBlockedError()
E       pytest_socket.SocketBlockedError: A test tried to use socket.socket.
.venv/lib/python3.11/site-packages/pytest_socket.py:89: SocketBlockedError
During handling of the above exception, another exception occurred:
    def test_basic_initialization():
        """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é CPUQueryEngine"""
        from rag import CPUEmbedder, QdrantVectorStore
    
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º CPUQueryEngine –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –º–æ–¥—É–ª—è
        from rag.query_engine import CPUQueryEngine
    
        from config import get_config
    
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        config = get_config(require_api_key=False)
    
        # –°–æ–∑–¥–∞—ë–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É Qdrant)
>       embedder = CPUEmbedder(
            config.rag.embeddings,
            config.rag.parallelism
        )
tests/test_cpu_query_engine.py:97: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:91: in __init__
    self._initialize_model()
rag/embedder.py:118: in _initialize_model
    self._try_fallback_initialization()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <rag.embedder.CPUEmbedder object at 0x7fc1c9bc8d10>
    def _try_fallback_initialization(self) -> None:
        """–ü–æ–ø—ã—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.warning("–ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é")
    
>       if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
           ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
rag/embedder.py:177: AttributeError
------------------------------ Captured log call -------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
_________________________ test_embedder_initialization _________________________
self = <rag.embedder.CPUEmbedder object at 0x7fc1c9882910>
    def _initialize_model(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.info(f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º: {self.embedding_config.provider}")
    
        try:
            if self.embedding_config.provider == "fastembed" and FASTEMBED_AVAILABLE:
>               self._initialize_fastembed()
rag/embedder.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:129: in _initialize_fastembed
    self.model = TextEmbedding(
.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py:114: in __init__
    self.model = EMBEDDING_MODEL_TYPE(
.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py:251: in __init__
    self._model_dir = self.download_model(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:421: in download_model
    cls.download_files_from_huggingface(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:241: in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py:2637: in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py:96: in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:464: in _make_request
    self._validate_conn(conn)
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:1093: in _validate_conn
    conn.connect()
.venv/lib/python3.11/site-packages/urllib3/connection.py:753: in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.11/site-packages/urllib3/util/connection.py:64: in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cls = <class 'pytest_socket.disable_socket.<locals>.GuardedSocket'>
family = <AddressFamily.AF_INET: 2>, type = <SocketKind.SOCK_STREAM: 1>
proto = 6, fileno = None
    def __new__(cls, family=-1, type=-1, proto=-1, fileno=None):
        if _is_unix_socket(family) and allow_unix_socket:
            return super().__new__(cls, family, type, proto, fileno)
    
>       raise SocketBlockedError()
E       pytest_socket.SocketBlockedError: A test tried to use socket.socket.
.venv/lib/python3.11/site-packages/pytest_socket.py:89: SocketBlockedError
During handling of the above exception, another exception occurred:
    def test_embedder_initialization():
        """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–µ—Ä–∞"""
        logger.info("=== –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ CPUEmbedder ===")
    
        from rag import CPUEmbedder
        from config import EmbeddingConfig, ParallelismConfig
    
        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        embedding_config = EmbeddingConfig(
            provider="fastembed",
            model_name="BAAI/bge-small-en-v1.5",
            warmup_enabled=False  # –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–≥—Ä–µ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞
        )
    
        parallelism_config = ParallelismConfig(
            torch_num_threads=2,
            omp_num_threads=2,
            mkl_num_threads=2
        )
    
        # –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞ (–º–æ–∂–µ—Ç –Ω–µ —É–¥–∞—Å—Ç—Å—è –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
        try:
>           embedder = CPUEmbedder(embedding_config, parallelism_config)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_rag_imports.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:91: in __init__
    self._initialize_model()
rag/embedder.py:118: in _initialize_model
    self._try_fallback_initialization()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <rag.embedder.CPUEmbedder object at 0x7fc1c9882910>
    def _try_fallback_initialization(self) -> None:
        """–ü–æ–ø—ã—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.warning("–ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é")
    
>       if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
           ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
rag/embedder.py:177: AttributeError
------------------------------ Captured log call -------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
____________________________ test_embedder_creation ____________________________
self = <rag.embedder.CPUEmbedder object at 0x7fc1c567c410>
    def _initialize_model(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.info(f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º: {self.embedding_config.provider}")
    
        try:
            if self.embedding_config.provider == "fastembed" and FASTEMBED_AVAILABLE:
>               self._initialize_fastembed()
rag/embedder.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:129: in _initialize_fastembed
    self.model = TextEmbedding(
.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py:114: in __init__
    self.model = EMBEDDING_MODEL_TYPE(
.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py:251: in __init__
    self._model_dir = self.download_model(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:421: in download_model
    cls.download_files_from_huggingface(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:241: in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py:2637: in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py:96: in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:464: in _make_request
    self._validate_conn(conn)
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:1093: in _validate_conn
    conn.connect()
.venv/lib/python3.11/site-packages/urllib3/connection.py:753: in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.11/site-packages/urllib3/util/connection.py:64: in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cls = <class 'pytest_socket.disable_socket.<locals>.GuardedSocket'>
family = <AddressFamily.AF_INET: 2>, type = <SocketKind.SOCK_STREAM: 1>
proto = 6, fileno = None
    def __new__(cls, family=-1, type=-1, proto=-1, fileno=None):
        if _is_unix_socket(family) and allow_unix_socket:
            return super().__new__(cls, family, type, proto, fileno)
    
>       raise SocketBlockedError()
E       pytest_socket.SocketBlockedError: A test tried to use socket.socket.
.venv/lib/python3.11/site-packages/pytest_socket.py:89: SocketBlockedError
During handling of the above exception, another exception occurred:
    def test_embedder_creation():
        """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ CPUEmbedder"""
        from rag.embedder import CPUEmbedder
        from config import get_config
    
        config = get_config(require_api_key=False)
>       embedder = CPUEmbedder(config.rag.embeddings, config.rag.parallelism)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_simple_cpu_query_engine.py:40: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:91: in __init__
    self._initialize_model()
rag/embedder.py:118: in _initialize_model
    self._try_fallback_initialization()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <rag.embedder.CPUEmbedder object at 0x7fc1c567c410>
    def _try_fallback_initialization(self) -> None:
        """–ü–æ–ø—ã—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.warning("–ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é")
    
>       if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
           ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
rag/embedder.py:177: AttributeError
------------------------------ Captured log call -------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
__________________________ test_query_engine_creation __________________________
self = <rag.embedder.CPUEmbedder object at 0x7fc1c30b6410>
    def _initialize_model(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.info(f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º: {self.embedding_config.provider}")
    
        try:
            if self.embedding_config.provider == "fastembed" and FASTEMBED_AVAILABLE:
>               self._initialize_fastembed()
rag/embedder.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:129: in _initialize_fastembed
    self.model = TextEmbedding(
.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py:114: in __init__
    self.model = EMBEDDING_MODEL_TYPE(
.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py:251: in __init__
    self._model_dir = self.download_model(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:421: in download_model
    cls.download_files_from_huggingface(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:241: in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py:2637: in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py:96: in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:464: in _make_request
    self._validate_conn(conn)
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:1093: in _validate_conn
    conn.connect()
.venv/lib/python3.11/site-packages/urllib3/connection.py:753: in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.11/site-packages/urllib3/util/connection.py:64: in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cls = <class 'pytest_socket.disable_socket.<locals>.GuardedSocket'>
family = <AddressFamily.AF_INET: 2>, type = <SocketKind.SOCK_STREAM: 1>
proto = 6, fileno = None
    def __new__(cls, family=-1, type=-1, proto=-1, fileno=None):
        if _is_unix_socket(family) and allow_unix_socket:
            return super().__new__(cls, family, type, proto, fileno)
    
>       raise SocketBlockedError()
E       pytest_socket.SocketBlockedError: A test tried to use socket.socket.
.venv/lib/python3.11/site-packages/pytest_socket.py:89: SocketBlockedError
During handling of the above exception, another exception occurred:
    def test_query_engine_creation():
        """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ CPUQueryEngine"""
        from rag.embedder import CPUEmbedder
        from rag.query_engine import CPUQueryEngine
        from config import get_config
    
        config = get_config(require_api_key=False)
>       embedder = CPUEmbedder(config.rag.embeddings, config.rag.parallelism)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_simple_cpu_query_engine.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:91: in __init__
    self._initialize_model()
rag/embedder.py:118: in _initialize_model
    self._try_fallback_initialization()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <rag.embedder.CPUEmbedder object at 0x7fc1c30b6410>
    def _try_fallback_initialization(self) -> None:
        """–ü–æ–ø—ã—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.warning("–ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é")
    
>       if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
           ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
rag/embedder.py:177: AttributeError
------------------------------ Captured log call -------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
_______________________ test_query_engine_async_methods ________________________
self = <rag.embedder.CPUEmbedder object at 0x7fc1c6b37110>
    def _initialize_model(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.info(f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–µ—Ä–∞ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º: {self.embedding_config.provider}")
    
        try:
            if self.embedding_config.provider == "fastembed" and FASTEMBED_AVAILABLE:
>               self._initialize_fastembed()
rag/embedder.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:129: in _initialize_fastembed
    self.model = TextEmbedding(
.venv/lib/python3.11/site-packages/fastembed/text/text_embedding.py:114: in __init__
    self.model = EMBEDDING_MODEL_TYPE(
.venv/lib/python3.11/site-packages/fastembed/text/onnx_embedding.py:251: in __init__
    self._model_dir = self.download_model(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:421: in download_model
    cls.download_files_from_huggingface(
.venv/lib/python3.11/site-packages/fastembed/common/model_management.py:241: in download_files_from_huggingface
    repo_revision = model_info(hf_source_repo).sha
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/hf_api.py:2637: in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:602: in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/huggingface_hub/utils/_http.py:96: in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:464: in _make_request
    self._validate_conn(conn)
.venv/lib/python3.11/site-packages/urllib3/connectionpool.py:1093: in _validate_conn
    conn.connect()
.venv/lib/python3.11/site-packages/urllib3/connection.py:753: in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
.venv/lib/python3.11/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.11/site-packages/urllib3/util/connection.py:64: in create_connection
    sock = socket.socket(af, socktype, proto)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cls = <class 'pytest_socket.disable_socket.<locals>.GuardedSocket'>
family = <AddressFamily.AF_INET: 2>, type = <SocketKind.SOCK_STREAM: 1>
proto = 6, fileno = None
    def __new__(cls, family=-1, type=-1, proto=-1, fileno=None):
        if _is_unix_socket(family) and allow_unix_socket:
            return super().__new__(cls, family, type, proto, fileno)
    
>       raise SocketBlockedError()
E       pytest_socket.SocketBlockedError: A test tried to use socket.socket.
.venv/lib/python3.11/site-packages/pytest_socket.py:89: SocketBlockedError
During handling of the above exception, another exception occurred:
    async def test_query_engine_async_methods():
        """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã CPUQueryEngine"""
        from rag.embedder import CPUEmbedder
        from rag.query_engine import CPUQueryEngine
        from config import get_config
    
        config = get_config(require_api_key=False)
>       embedder = CPUEmbedder(config.rag.embeddings, config.rag.parallelism)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_simple_cpu_query_engine.py:91: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag/embedder.py:91: in __init__
    self._initialize_model()
rag/embedder.py:118: in _initialize_model
    self._try_fallback_initialization()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
self = <rag.embedder.CPUEmbedder object at 0x7fc1c6b37110>
    def _try_fallback_initialization(self) -> None:
        """–ü–æ–ø—ã—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞"""
        logger.warning("–ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é")
    
>       if self.provider_name != "sentence-transformers" and SENTENCE_TRANSFORMERS_AVAILABLE:
           ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
rag/embedder.py:177: AttributeError
------------------------------ Captured log call -------------------------------
ERROR    rag.embedder:embedder.py:140 –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FastEmbed: A test tried to use socket.socket.
ERROR    rag.embedder:embedder.py:116 –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: A test tried to use socket.socket.
WARNING  rag.embedder:embedder.py:175 –ü—ã—Ç–∞–µ–º—Å—è fallback –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
=========================== short test summary info ============================
FAILED tests/rag/test_rag_e2e_cli.py::TestRAGCliE2E::test_rag_commands_keyboard_interrupt - assert ('–ø—Ä–µ—Ä–≤–∞–Ω' in "üîÑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nqdrant: localhost:6333\n–∫–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'cpuembedder' object has no attribute 'provider_name'\n" or 'interrupt' in "üîÑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nqdrant: localhost:6333\n–∫–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'cpuembedder' object has no attribute 'provider_name'\n")
 +  where "üîÑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nqdrant: localhost:6333\n–∫–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'cpuembedder' object has no attribute 'provider_name'\n" = <built-in method lower of str object at 0x56349741cc80>()
 +    where <built-in method lower of str object at 0x56349741cc80> = "üîÑ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nQdrant: localhost:6333\n–ö–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'CPUEmbedder' object has no attribute 'provider_name'\n".lower
 +      where "üîÑ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nQdrant: localhost:6333\n–ö–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'CPUEmbedder' object has no attribute 'provider_name'\n" = <Result SystemExit(1)>.output
 +  and   "üîÑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nqdrant: localhost:6333\n–∫–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'cpuembedder' object has no attribute 'provider_name'\n" = <built-in method lower of str object at 0x5634a49e9850>()
 +    where <built-in method lower of str object at 0x5634a49e9850> = "üîÑ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nQdrant: localhost:6333\n–ö–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'CPUEmbedder' object has no attribute 'provider_name'\n".lower
 +      where "üîÑ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: /tmp/tmp45a8qh4f.json\nQdrant: localhost:6333\n–ö–æ–ª–ª–µ–∫—Ü–∏—è: test_e2e_collection\n–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 512\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: 'CPUEmbedder' object has no attribute 'provider_name'\n" = <Result SystemExit(1)>.output
FAILED tests/rag/test_rag_e2e_cli.py::TestRAGCliE2E::test_rag_commands_connection_errors - assert False
 +  where False = any(<generator object TestRAGCliE2E.test_rag_commands_connection_errors.<locals>.<genexpr> at 0x7fc1c9996420>)
FAILED tests/rag/test_rag_integration.py::TestRAGIntegration::test_embedder_initialization - AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
FAILED tests/test_cpu_query_engine.py::test_basic_initialization - AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
FAILED tests/test_rag_imports.py::test_embedder_initialization - AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
FAILED tests/test_simple_cpu_query_engine.py::test_embedder_creation - AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
FAILED tests/test_simple_cpu_query_engine.py::test_query_engine_creation - AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
FAILED tests/test_simple_cpu_query_engine.py::test_query_engine_async_methods - AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
ERROR tests/test_cpu_query_engine.py::test_basic_functionality - AttributeError: 'CPUEmbedder' object has no attribute 'provider_name'
Error: Process completed with exit code 1.