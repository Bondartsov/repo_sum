# üìã MILESTONE M2: IMPLEMENTATION PLAN - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ BM25/SPLADE
**‚ö†Ô∏è –í–†–ï–ú–ï–ù–ù–´–ô –î–û–ö–£–ú–ï–ù–¢ - –£–î–ê–õ–ò–¢–¨ –ü–û–°–õ–ï –ó–ê–í–ï–†–®–ï–ù–ò–Ø M2 ‚ö†Ô∏è**

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 04.09.2025  
**–¶–µ–ª–µ–≤–æ–π —Å—Ä–æ–∫:** 2-3 –Ω–µ–¥–µ–ª–∏  
**–°—Ç–∞—Ç—É—Å:** –í –†–ê–ë–û–¢–ï  
**–í–µ—Ä—Å–∏—è –ø–ª–∞–Ω–∞:** 1.0.0

---

## üéØ –¶–µ–ª—å Milestone M2
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è sparse vectors (BM25/SPLADE) –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π dense embeddings —Å–∏—Å—Ç–µ–º–µ —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º RRF fusion –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–æ–¥—É.

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
- [ ] **Precision@10** —É–ª—É—á—à–µ–Ω–∞ –Ω–∞ 15-20% –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
- [ ] **Recall@100** —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ 25-30% –∑–∞ —Å—á–µ—Ç sparse matching  
- [ ] **MRR** –ø–æ–≤—ã—à–µ–Ω –Ω–∞ 10-15%
- [ ] **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ <300ms p95
- [ ] **–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã** –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å (149 passed)

---

## ‚úÖ –û–°–ù–û–í–ù–û–ô –ß–ï–ö-–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### üìö –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ [–î–µ–Ω—å 1] ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

- [x] –°–æ–∑–¥–∞—Ç—å feature branch `feature/milestone-m2-hybrid-search`
- [x] –û–±–Ω–æ–≤–∏—Ç—å Memory Bank (.clinerules) —Å –ø–ª–∞–Ω–æ–º M2
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  - [x] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã rank-bm25>=0.2.2, nltk>=3.8
  - [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã fastembed>=0.3.6, sentence-transformers>=5.1.0
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Qdrant (10.61.11.54:6333) - ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω, 286 points
- [x] –°–æ–∑–¥–∞—Ç—å backup —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `code_chunks` - ‚úÖ Snapshot: code_chunks-7716533420395971-2025-09-04-15-43-22.snapshot

### üîß –§–∞–∑–∞ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤ [–î–µ–Ω—å 1-2]

#### ‚úÖ 1.1 QueryEngine –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –ó–ê–í–ï–†–®–ï–ù–û (4.09.2025)
- [x] **rag/query_engine.py:573** - –ò–°–ü–†–ê–í–õ–ï–ù–û: `store.is_connected()` –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ `vector_store.health_check()`
- [x] **rag/query_engine.py:521** - –ò–°–ü–†–ê–í–õ–ï–ù–û: `self.embedder.embedding_dim` –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ `config.vector_store.vector_size`
- [x] –°–û–ó–î–ê–ù–û: unit —Ç–µ—Å—Ç—ã `tests/rag/test_query_engine_health.py` (7 —Ç–µ—Å—Ç–æ–≤)
- [x] –í–ê–õ–ò–î–ò–†–û–í–ê–ù–û: –∫–æ–º–∞–Ω–¥–∞ `rag status` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, MMR fallback —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å—é (384)

#### 1.2 SearchService –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è  
- [x] **rag/search_service.py:127** - –ò—Å–ø—Ä–∞–≤–∏—Ç—å `min_score or 0.5` –Ω–∞ `min_score if min_score is not None else 0.5` (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ 05.09.2025)
- [x] **rag/search_service.py** - –î–æ–±–∞–≤–∏—Ç—å `score_threshold` –≤ `get_search_stats()` (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ 05.09.2025)
- [x] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ `min_score=0.0` (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ 05.09.2025)

#### 1.3 Config —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- [x] **config.py:134** - –ò–∑–º–µ–Ω–∏—Ç—å `QueryEngineConfig.score_threshold` —Å 0.7 –Ω–∞ 0.5 (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ 05.09.2025)
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [x] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### 1.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–Ω–æ –≤–∞–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π —Ä–∞–∑–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –≤–ø–æ–ª–Ω–µ –≤–æ–∑–º–æ–¥–Ω–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ —Ç–∫–∏–µ –≤–µ—Ä—Å–∏–∏. –í –æ—å—â–µ–º, –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ mcp Context7 –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å –¥–æ–∫–∏ –∫–∞–∂–¥–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º. –ù–æ –≤ —Ü–µ–ª–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –º–∞–∫–∏—Å–º–∞–ª—å–Ω–æ —Å–≤–µ–∂–∏–º –≤–µ—Ä—Å–∏—è–º –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–∞–≤–∞—Ç—å –Ω–∞–¥–æ)
- [x] **requirements.txt** - –û–±–Ω–æ–≤–∏—Ç—å `fastembed>=0.3.6` (–±—ã–ª–æ 0.3.0)
- [x] **requirements.txt** - –û–±–Ω–æ–≤–∏—Ç—å `sentence-transformers>=5.1.0` (–±—ã–ª–æ 3.0.0)
- [x] –ó–∞–ø—É—Å—Ç–∏—Ç—å `pip install -r requirements.txt --upgrade`
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π

### üèóÔ∏è –§–∞–∑–∞ 2: –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Sparse Encoding [–î–µ–Ω—å 3-4]

#### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ rag/sparse_encoder.py
- [x] –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `BaseSparseEncoder`
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `BM25Encoder` –∫–ª–∞—Å—Å:
  - [x] `__init__()` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π BM25 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - [x] `fit()` –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è vocabulary –∏–∑ –∫–æ—Ä–ø—É—Å–∞
  - [x] `encode()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ sparse vectors
  - [x] `batch_encode()` –¥–ª—è –±–∞—Ç—á–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `CodeTokenizer` –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏:
  - [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ camelCase: `getUserName` ‚Üí `["get", "user", "name"]`
  - [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ snake_case: `get_user_name` ‚Üí `["get", "user", "name"]`
  - [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤: `__init__` ‚Üí `["init"]`
  - [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ—á–µ—á–Ω–æ–π –Ω–æ—Ç–∞—Ü–∏–∏: `self.config.value` ‚Üí `["self", "config", "value"]`
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏ vocabulary
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `get_stats()` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### 2.2 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è sparse_encoder
- [x] **tests/rag/test_sparse_encoder.py** - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
- [x] –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ BM25Encoder
- [x] –¢–µ—Å—Ç —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –∫–æ–¥–∞:
  - [x] camelCase —Ç–µ—Å—Ç—ã
  - [x] snake_case —Ç–µ—Å—Ç—ã
  - [x] –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã —Ç–µ—Å—Ç—ã
  - [x] –°–º–µ—à–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ —Ç–µ—Å—Ç—ã
- [x] –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ sparse vectors:
  - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏
  - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ sparsity (>95% –Ω—É–ª–µ–π)
  - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏
- [x] –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏ vocabulary
- [x] Performance —Ç–µ—Å—Ç: –≤—Ä–µ–º—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è 1000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### 2.3 –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è SPLADE –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ GPU –¥–æ—Å—Ç—É–ø–µ–Ω)
- [x] –î–æ–±–∞–≤–∏—Ç—å `SPLADEEncoder` –∫–ª–∞—Å—Å
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å transformers –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π
- [x] –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ BM25 –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ GPU
- [x] –¢–µ—Å—Ç—ã –¥–ª—è SPLADE (–ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –µ—Å–ª–∏ –Ω–µ—Ç GPU)

### üíæ –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Sparse Store [–î–µ–Ω—å 5-6]

#### 3.1 –°–æ–∑–¥–∞–Ω–∏–µ rag/sparse_store.py
- [ ] –°–æ–∑–¥–∞—Ç—å `QdrantSparseStore` –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π `QdrantVectorStore`
- [ ] –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è sparse vectors:
  - [ ] –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è sparse –¥–∞–Ω–Ω—ã—Ö
  - [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ HNSW –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è sparse
  - [ ] CSR —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `create_sparse_collection()` –º–µ—Ç–æ–¥
- [ ] –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å `index_documents()` –¥–ª—è sparse vectors
- [ ] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `search()` –¥–ª—è sparse –ø–æ–∏—Å–∫–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å `convert_sparse_to_dense()` —É—Ç–∏–ª–∏—Ç—É

#### 3.2 –¢–µ—Å—Ç—ã –¥–ª—è sparse_store
- [ ] **tests/rag/test_sparse_store.py** - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
- [ ] –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è sparse –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ Qdrant
- [ ] –¢–µ—Å—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ sparse –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø–æ sparse vectors
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ sparse vs dense
- [ ] Integration —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º Qdrant

### üîÄ –§–∞–∑–∞ 4: –£–ª—É—á—à–µ–Ω–Ω—ã–π RRF Fusion [–î–µ–Ω—å 7-8]

#### 4.1 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ rag/query_engine.py
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `_reciprocal_rank_fusion()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏:
  - [ ] –ü—Ä–∏–Ω–∏–º–∞—Ç—å dict —Å {'dense': [...], 'sparse': [...]}
  - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å weighted RRF —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –≤–µ—Å–∞–º–∏
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Å–∫–æ—Ä–æ–≤ –ø–µ—Ä–µ–¥ fusion
- [ ] –°–æ–∑–¥–∞—Ç—å `_normalize_scores()` –º–µ—Ç–æ–¥:
  - [ ] Min-max –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
  - [ ] Z-score –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è  
  - [ ] –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å `_weighted_rrf()` –º–µ—Ç–æ–¥ –¥–ª—è –≤–∑–≤–µ—à–µ–Ω–Ω–æ–≥–æ fusion
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `search()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ fusion

#### 4.2 –¢–µ—Å—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ RRF
- [ ] **tests/rag/test_rrf_enhancement.py** - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
- [ ] –¢–µ—Å—Ç fusion —Å 2 —Å–ø–∏—Å–∫–∞–º–∏ (dense + sparse)
- [ ] –¢–µ—Å—Ç fusion —Å 3+ —Å–ø–∏—Å–∫–∞–º–∏
- [ ] –¢–µ—Å—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç –≤–∑–≤–µ—à–µ–Ω–Ω–æ–≥–æ RRF
- [ ] –¢–µ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Å–∫–æ—Ä–æ–≤
- [ ] Benchmark: —É–ª—É—á—à–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞

### üé≠ –§–∞–∑–∞ 5: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä [–î–µ–Ω—å 9-10]

#### 5.1 –°–æ–∑–¥–∞–Ω–∏–µ rag/hybrid_search.py
- [ ] –°–æ–∑–¥–∞—Ç—å `HybridSearchOrchestrator` –∫–ª–∞—Å—Å:
  - [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å dense –∏ sparse –¥–≤–∏–∂–∫–∞–º–∏
  - [ ] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–æ–≤ —á–µ—Ä–µ–∑ asyncio
  - [ ] –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ enhanced RRF
  - [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `parallel_search()` –º–µ—Ç–æ–¥
- [ ] –î–æ–±–∞–≤–∏—Ç—å `auto_tune_weights()` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–µ—Å–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `SearchService`
- [ ] –î–æ–±–∞–≤–∏—Ç—å detailed logging –∏ –º–µ—Ç—Ä–∏–∫–∏

#### 5.2 –¢–µ—Å—Ç—ã –¥–ª—è hybrid_search
- [ ] **tests/rag/test_hybrid_search.py** - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
- [ ] –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- [ ] –¢–µ—Å—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤
- [ ] –¢–µ—Å—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –¢–µ—Å—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] E2E —Ç–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- [ ] Performance benchmark vs —á–∏—Å—Ç—ã–π dense

### üîÑ –§–∞–∑–∞ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É [–î–µ–Ω—å 11-12]

#### 6.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SearchService
- [ ] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `rag/search_service.py`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `sparse_encoder` –∏ `sparse_store` –∞—Ç—Ä–∏–±—É—Ç—ã
  - [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å `search()` –º–µ—Ç–æ–¥ –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `search_mode`: dense/sparse/hybrid
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≥–∏–±—Ä–∏–¥–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å backward compatibility —Ñ–ª–∞–≥–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `format_search_results()` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞

#### 6.2 CLI –∫–æ–º–∞–Ω–¥—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `main.py` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `--search-mode` –ø–∞—Ä–∞–º–µ—Ç—Ä –∫ `rag search`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `--dense-weight` –∏ `--sparse-weight` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  - [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å `rag status` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è sparse —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –°–æ–∑–¥–∞—Ç—å `rag index-sparse` –∫–æ–º–∞–Ω–¥—É –¥–ª—è sparse –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å `rag benchmark` –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤

#### 6.3 Web UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `web_ui.py`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –ø–æ–∏—Å–∫–∞ (radio buttons)
  - [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥–µ—Ä—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ—Å–æ–≤
  - [ ] –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (dense/sparse)
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### üß™ –§–∞–∑–∞ 7: –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ [–î–µ–Ω—å 13-14]

#### 7.1 –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] **tests/test_cpu_query_engine.py** - –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- [ ] **tests/test_simple_cpu_query_engine.py** - –¥–æ–±–∞–≤–∏—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] **tests/rag/test_rag_integration.py** - —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è sparse/hybrid
- [ ] **tests/rag/test_rag_e2e_cli.py** - –¥–æ–±–∞–≤–∏—Ç—å CLI —Ç–µ—Å—Ç—ã –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- [ ] **tests/rag/test_rag_performance.py** - –¥–æ–±–∞–≤–∏—Ç—å benchmarks

#### 7.2 –ù–æ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] **tests/rag/test_m2_integration.py** - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:
  - [ ] –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è dense + sparse
  - [ ] –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞
  - [ ] Stress —Ç–µ—Å—Ç —Å 10000+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - [ ] Concurrent users —Ç–µ—Å—Ç (20 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö)

#### 7.3 E2E —Ç–µ—Å—Ç—ã
- [ ] **tests/e2e/test_e2e_hybrid_search.py** - —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:
  - [ ] –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ workflow —á–µ—Ä–µ–∑ CLI
  - [ ] –¢–µ—Å—Ç —á–µ—Ä–µ–∑ Web UI (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
  - [ ] –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º
  - [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ dense vs hybrid

#### 7.4 Pytest –º–∞—Ä–∫–µ—Ä—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å `@pytest.mark.m2` –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å `@pytest.mark.sparse` –¥–ª—è sparse-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å `@pytest.mark.hybrid` –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `pytest.ini` —Å –Ω–æ–≤—ã–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏

### üìù –§–∞–∑–∞ 8: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è [–î–µ–Ω—å 15]

#### 8.1 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [ ] **rag/README_M2.md** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- [ ] **rag/SPARSE_ENCODING.md** - –¥–µ—Ç–∞–ª–∏ sparse encoding
- [ ] **rag/RRF_ALGORITHM.md** - –æ–ø–∏—Å–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ RRF
- [ ] –û–±–Ω–æ–≤–∏—Ç—å **README.md** —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

#### 8.2 –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è  
- [ ] **QUICK_START_HYBRID.md** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
- [ ] –û–±–Ω–æ–≤–∏—Ç—å **QUICK_START_RAG.md** —Å –Ω–æ–≤—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ CLI –∏ Web UI
- [ ] FAQ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –≤–µ—Å–æ–≤ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

#### 8.3 API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] Docstrings –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
- [ ] Type hints –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- [ ] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ docstrings

### üöÄ –§–∞–∑–∞ 9: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —Ç—é–Ω–∏–Ω–≥ [–î–µ–Ω—å 16-17]

#### 9.1 Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å cProfile
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç–µ–π
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –±–∞—Ç—á–µ–π
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

#### 9.2 –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞ —Ç—é–Ω–∏–Ω–≥
- [ ] –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å –≤–µ—Å–∞–º–∏ dense/sparse
- [ ] –ü–æ–¥–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ RRF k –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- [ ] –¢—é–Ω–∏–Ω–≥ BM25 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (k1, b)
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ benchmark –¥–∞—Ç–∞—Å–µ—Ç–∞

#### 9.3 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- [ ] –°–æ–∑–¥–∞—Ç—å Grafana dashboard
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –¥–ª—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫

### ‚úÖ –§–∞–∑–∞ 10: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è [–î–µ–Ω—å 18-20]

#### 10.1 Code review –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- [ ] –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π code review –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º review
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ code style (black, flake8)
- [ ] –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ code smells
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤

#### 10.2 –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ backward compatibility
- [ ] Smoke —Ç–µ—Å—Ç—ã –Ω–∞ production-like –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- [ ] Load testing —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π
- [ ] Security review –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### 10.3 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–µ–ª–∏–∑—É
- [ ] –û–±–Ω–æ–≤–∏—Ç—å version –≤ config
- [ ] –°–æ–∑–¥–∞—Ç—å CHANGELOG_M2.md
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å release notes
- [ ] –°–æ–∑–¥–∞—Ç—å migration guide –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] Backup production –¥–∞–Ω–Ω—ã—Ö

#### 10.4 Deployment
- [ ] Merge feature branch –≤ main
- [ ] –°–æ–∑–¥–∞—Ç—å git tag v1.8.0-m2
- [ ] Deploy –Ω–∞ staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ staging
- [ ] Deploy –Ω–∞ production
- [ ] Post-deployment –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### üßπ Cleanup
- [ ] –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª MILESTONE_M2_IMPLEMENTATION_PLAN.md
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Memory Bank —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ M2
- [ ] –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏
- [ ] Cleanup –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üìã –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### config.py —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
```python
@dataclass
class SparseEncoderConfig:
    - [ ] algorithm: str = "bm25"  # bm25, splade, hybrid
    - [ ] vocab_size: int = 30000
    - [ ] k1: float = 1.2  # BM25 –ø–∞—Ä–∞–º–µ—Ç—Ä
    - [ ] b: float = 0.75  # BM25 –ø–∞—Ä–∞–º–µ—Ç—Ä  
    - [ ] min_df: int = 2  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è document frequency
    - [ ] max_df: float = 0.95  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è document frequency
    - [ ] code_tokenization: bool = True
    - [ ] lowercase: bool = True
    - [ ] remove_punctuation: bool = True
    - [ ] stem: bool = False  # Stemming –¥–ª—è –∫–æ–¥–∞ –æ–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–µ–Ω
    
@dataclass
class HybridSearchConfig:
    - [ ] mode: str = "hybrid"  # dense, sparse, hybrid
    - [ ] dense_weight: float = 0.6
    - [ ] sparse_weight: float = 0.4
    - [ ] rrf_k: int = 60
    - [ ] score_normalization: str = "minmax"
    - [ ] auto_tune: bool = False  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –≤–µ—Å–æ–≤
    - [ ] fallback_to_dense: bool = True  # –ü—Ä–∏ –æ—à–∏–±–∫–µ sparse
```

### settings.json –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```json
{
  "rag": {
    "sparse_encoder": {
      - [ ] "algorithm": "bm25",
      - [ ] "vocab_size": 30000,
      - [ ] "k1": 1.2,
      - [ ] "b": 0.75,
      - [ ] "code_tokenization": true
    },
    "hybrid_search": {
      - [ ] "mode": "hybrid",
      - [ ] "dense_weight": 0.6,
      - [ ] "sparse_weight": 0.4,
      - [ ] "rrf_k": 60,
      - [ ] "score_normalization": "minmax"
    },
    "sparse_store": {
      - [ ] "collection_name": "code_chunks_sparse",
      - [ ] "host": "localhost",
      - [ ] "port": 6333
    }
  }
}
```

### Environment variables (.env)
```bash
- [ ] SPARSE_ENCODER_ALGORITHM=bm25
- [ ] SPARSE_VOCAB_SIZE=30000
- [ ] HYBRID_SEARCH_MODE=hybrid
- [ ] HYBRID_DENSE_WEIGHT=0.6
- [ ] HYBRID_SPARSE_WEIGHT=0.4
- [ ] SPARSE_COLLECTION_NAME=code_chunks_sparse
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ M2

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ CLI
- [ ] –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Web UI
- [ ] Sparse –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] RRF –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- [ ] Backward compatibility —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å <300ms p95
- [ ] –ü–∞–º—è—Ç—å <700MB –¥–ª—è 1000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] 149+ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] Code coverage >80% –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] Precision@10 —É–ª—É—á—à–µ–Ω–∞ –º–∏–Ω–∏–º—É–º –Ω–∞ 10%
- [ ] Recall@100 —É–ª—É—á—à–µ–Ω –º–∏–Ω–∏–º—É–º –Ω–∞ 15%
- [ ] MRR —É–ª—É—á—à–µ–Ω –º–∏–Ω–∏–º—É–º –Ω–∞ 5%
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–≤–æ–ª—å–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (feedback)

---

## üìÖ Timeline –∏ —Ä–µ—Å—É—Ä—Å—ã

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 18-20 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π  
**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** 1-2 —á–µ–ª–æ–≤–µ–∫–∞  
**–†–∏—Å–∫–∏:** –°—Ä–µ–¥–Ω–∏–µ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏)  

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏:
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –±–∞–≥—Ñ–∏–∫—Å—ã: 2 –¥–Ω—è
- Sparse –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: 4 –¥–Ω—è
- RRF –∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫: 4 –¥–Ω—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: 3 –¥–Ω—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 3 –¥–Ω—è
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: 2 –¥–Ω—è
- –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è: 2 –¥–Ω—è

---

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏
1. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
   
2. **–†–∞–∑–º–µ—Ä sparse –∏–Ω–¥–µ–∫—Å–∞**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: CSR —Ñ–æ—Ä–º–∞—Ç, –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ, —Å–∂–∞—Ç–∏–µ
   
3. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: Mocking Qdrant –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏
1. **Scope creep**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ß–µ—Ç–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏, —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ check-ins
   
2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Qdrant**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: Fallback –Ω–∞ pure dense –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

---

## üìù –ó–∞–º–µ—Ç–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

_–ú–µ—Å—Ç–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏_

---

## ‚úÖ –ò—Ç–æ–≥
Milestone M2 –∑–∞–≤–µ—Ä—à—ë–Ω. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ BM25/SPLADE —Å RRF fusion, –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.
