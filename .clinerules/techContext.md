# Technical Context: Repository Analyzer

**–î–∞—Ç–∞:** 11 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** Production-Ready —Å–∏—Å—Ç–µ–º–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏  
**–í–µ—Ä—Å–∏—è:** 0.5 (M2 –∑–∞–≤–µ—Ä—à—ë–Ω)

---

## üèóÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **Python 3.8+**: –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **OpenAI GPT API** >= 1.99.6 - –ò–ò-–∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
- **Qdrant** >= 1.15.1 - Enterprise-ready –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ–º
- **FastEmbed** >= 0.3.6 - CPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (ONNX Runtime)
- **Sentence-Transformers** >= 5.1.0 - fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- **Streamlit** >= 1.46.0 - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å RAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- **AST (Abstract Syntax Tree)** - –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥–∞ –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤
- **Markdown** - —Ñ–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### RAG —Å–∏—Å—Ç–µ–º–∞ (Production-Ready):
```
rag/
‚îú‚îÄ‚îÄ embedder.py         # CPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–º–±–µ–¥–¥–µ—Ä
‚îú‚îÄ‚îÄ vector_store.py     # Qdrant –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ–º
‚îú‚îÄ‚îÄ query_engine.py     # –ü–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ —Å RRF/MMR
‚îú‚îÄ‚îÄ indexer_service.py  # –°–µ—Ä–≤–∏—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îú‚îÄ‚îÄ search_service.py   # –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ sparse_encoder.py   # BM25/SPLADE –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ exceptions.py       # –°–∏—Å—Ç–µ–º–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ):
```txt
# Core dependencies
openai>=1.99.6                    # OpenAI API –∫–ª–∏–µ–Ω—Ç
streamlit>=1.46.0                 # Web UI
python-dotenv>=1.0.0              # Environment variables
click>=8.1.8                      # CLI framework
rich>=14.0.0                      # CLI UI library

# RAG System (CPU-first)
qdrant-client[fastembed]>=1.15.1  # FastEmbed + Qdrant –∫–ª–∏–µ–Ω—Ç
sentence-transformers>=5.1.0      # Fallback —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
numpy>=1.24.0                     # –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
psutil>=5.9.5                     # RAM –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
cachetools>=5.3.0                 # LRU/TTL –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

# Hybrid Search (M2)
rank-bm25>=0.2.2                  # BM25 –∞–ª–≥–æ—Ä–∏—Ç–º
nltk>=3.8                         # –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è
transformers>=4.44.0              # –î–ª—è SPLADE / AutoModelForMaskedLM
datasets>=2.21.0                  # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä–æ–≤/–¥–∞—Ç–∞—Å–µ—Ç–æ–≤

# Testing & Development
pytest>=8.3.4                     # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pytest-asyncio>=1.1.0             # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

---

## üèõÔ∏è –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. CPU-First Architecture
**–ü—Ä–∏–Ω—Ü–∏–ø**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —à–∏—Ä–æ–∫–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –±–µ–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è GPU
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:
- FastEmbed —Å ONNX Runtime –≤–º–µ—Å—Ç–æ GPU-–∑–∞–≤–∏—Å–∏–º—ã—Ö —Ä–µ—à–µ–Ω–∏–π
- HNSW –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è CPU (m=24, ef_construct=128)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏ —á–µ—Ä–µ–∑ OMP_NUM_THREADS, MKL_NUM_THREADS
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–∞—Ç—á–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π RAM

### 2. Modular Architecture Pattern
**–ü—Ä–∏–Ω—Ü–∏–ø**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —Å–ª–∞–±–æ—Å–≤—è–∑–∞–Ω–Ω—ã–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```
repo_sum/
‚îú‚îÄ‚îÄ Core System/        # –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ RAG System/         # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
‚îú‚îÄ‚îÄ Parsers System/     # –Ø–∑—ã–∫–æ–≤—ã–µ –ø–∞—Ä—Å–µ—Ä—ã
‚îú‚îÄ‚îÄ UI System/          # CLI + Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã  
‚îî‚îÄ‚îÄ Testing System/     # –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π

### 3. Configuration-Driven Development
**–ü—Ä–∏–Ω—Ü–∏–ø**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- `settings.json` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `.env` - environment variables –¥–ª—è production
- `@dataclass` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**–ü—Ä–∏–º–µ—Ä**:
```python
@dataclass
class EmbeddingConfig:
    provider: str = "fastembed"
    model_name: str = "BAAI/bge-small-en-v1.5"
    batch_size_max: int = 512
    normalize_embeddings: bool = True
```

---

## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Core —Å–∏—Å—Ç–µ–º–∞:
1. **RepositoryAnalyzer** (main.py) - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∞–Ω–∞–ª–∏–∑–∞
2. **FileScanner** (file_scanner.py) - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
3. **ParserRegistry** (parsers/) - –≤—ã–±–æ—Ä –ø–∞—Ä—Å–µ—Ä–∞ –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞
4. **CodeChunker** (code_chunker.py) - —Ä–∞–∑–±–∏–≤–∫–∞ –∫–æ–¥–∞ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏
5. **OpenAIManager** (openai_integration.py) - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI API
6. **DocumentationGenerator** (doc_generator.py) - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Markdown –æ—Ç—á–µ—Ç–æ–≤

### RAG —Å–∏—Å—Ç–µ–º–∞ (Production-Ready):
1. **CPUEmbedder** (rag/embedder.py) - CPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–º–±–µ–¥–¥–µ—Ä
2. **QdrantVectorStore** (rag/vector_store.py) - –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
3. **CPUQueryEngine** (rag/query_engine.py) - –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ —Å RRF + MMR
4. **IndexerService** (rag/indexer_service.py) - —Å–µ—Ä–≤–∏—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
5. **SearchService** (rag/search_service.py) - –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫
6. **SparseEncoder** (rag/sparse_encoder.py) - BM25/SPLADE –≤–µ–∫—Ç–æ—Ä—ã (M2)

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏:
- Python (.py) - –ø–æ–ª–Ω—ã–π AST –∞–Ω–∞–ª–∏–∑
- JavaScript/TypeScript (.js, .ts, .jsx, .tsx)
- Java (.java), C++ (.cpp), C# (.cs)
- Go (.go), Rust (.rs), PHP (.php), Ruby (.rb)

---

## üîß –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Plugin Architecture Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤ —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
class BaseParser(ABC):
    @abstractmethod
    def parse(self, content: str) -> ParsedData
    
class PythonParser(BaseParser):
    def parse(self, content: str) -> ParsedData:
        # Python-specific parsing logic
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —è–∑—ã–∫–æ–≤
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞

### 2. Strategy Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ chunking'–∞ –∫–æ–¥–∞
**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏**:
- **logical**: —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º/–∫–ª–∞—Å—Å–∞–º (~5 —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ —á–∞–Ω–∫)
- **size**: —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –≤ —Ç–æ–∫–µ–Ω–∞—Ö
- **lines**: —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç—Ä–æ–∫

**–í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**: –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —è–∑—ã–∫–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞

### 3. Factory Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–æ–≤ –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
class ParserRegistry:
    def get_parser(self, file_extension: str) -> BaseParser:
        return self._parsers.get(file_extension, DefaultParser())
```

---

## üìä –ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. Pipeline Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∞–Ω–∞–ª–∏–∑–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
**–ü–∞–π–ø–ª–∞–π–Ω**:
```
scan_files() ‚Üí filter_files() ‚Üí chunk_code() ‚Üí 
embed_chunks() ‚Üí analyze_with_gpt() ‚Üí generate_docs()
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ testable
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ

### 2. Batch Processing Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è API –≤—ã–∑–æ–≤–æ–≤ –∏ memory usage
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –±–∞—Ç—á–µ–π: 2-8 —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- 8-512 –≤–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç RAM
- –ë–∞—Ç—á–µ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Qdrant —Å retry –ª–æ–≥–∏–∫–æ–π

**–ê–ª–≥–æ—Ä–∏—Ç–º –∞–¥–∞–ø—Ç–∞—Ü–∏–∏**:
```python
def calc_batch_size(q_len, cfg):
    avail = psutil.virtual_memory().available
    if avail > 8 * 1024**3:
        return min(cfg.batch_size_max, max(16, q_len))
    return max(cfg.batch_size_min, min(cfg.batch_size_max, q_len // 2))
```

### 3. Multi-Level Caching Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö —Å–∏—Å—Ç–µ–º—ã
**–£—Ä–æ–≤–Ω–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**:
1. **File-level cache**: Hash-based –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–æ–≤
2. **RAG search cache**: LRU —Å TTL (300s, 1000 –∑–∞–ø–∏—Å–µ–π) –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤  
3. **Embedding cache**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
4. **API response cache**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ OpenAI API

**TTL —Å—Ç—Ä–∞—Ç–µ–≥–∏—è**:
```python
from cachetools import TTLCache
search_cache = TTLCache(maxsize=1000, ttl=300)  # 5 –º–∏–Ω—É—Ç
```

---

## üîç RAG-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### 1. Reciprocal Rank Fusion (RRF) Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ dense –∏ sparse –ø–æ–∏—Å–∫–∞
**–ê–ª–≥–æ—Ä–∏—Ç–º**:
```python
def rrf(lists, k=60):
    fused = defaultdict(float)
    for lst in lists:
        for rank, (pid, _) in enumerate(lst, start=1):
            fused[pid] += 1.0 / (k + rank)
    return sorted(fused.items(), key=lambda x: x[1], reverse=True)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–∏—Å–∫–∞
- –£—Å—Ç–æ–π—á–∏–≤ –∫ outliers –≤ –æ–¥–Ω–æ–º –∏–∑ —Å–ø–∏—Å–∫–æ–≤
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ debugging'–∞

### 2. Maximum Marginal Relevance (MMR) Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
**–¶–µ–ª—å**: –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
**–§–æ—Ä–º—É–ª–∞**: `MMR = Œª * Relevance - (1-Œª) * MaxSimilarity`

### 3. Hybrid Search Pattern (M2)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ dense –∏ sparse –≤–µ–∫—Ç–æ—Ä–æ–≤
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
[Query] ‚Üí ‚îú‚îÄ[Dense Embedder] ‚Üí Dense Search
          ‚îî‚îÄ[Sparse Encoder] ‚Üí Sparse Search (BM25/SPLADE)
                                     ‚Üì
                               [RRF Fusion]
                                     ‚Üì
                               [MMR Re-ranking]
```

---

## ‚ö° –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. Lazy Loading Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
**–ü—Ä–∏–º–µ—Ä—ã**:
- –ü–∞—Ä—Å–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- –ú–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- Web UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É

### 2. Resource Pooling Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ—Ä–æ–≥–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
**–†–µ—Å—É—Ä—Å—ã**:
- OpenAI HTTP –∫–ª–∏–µ–Ω—Ç (–µ–¥–∏–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- Qdrant —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (connection pooling)
- Thread pools –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 3. Adaptive Threading Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU —Ä–µ—Å—É—Ä—Å–æ–≤
**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```python
def configure_threads(parallelism_config):
    torch.set_num_threads(parallelism_config.torch_num_threads)
    os.environ["OMP_NUM_THREADS"] = str(parallelism_config.omp_num_threads)
    os.environ["MKL_NUM_THREADS"] = str(parallelism_config.mkl_num_threads)
```

### 4. Memory-Aware Processing Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏
**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏**:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ–π RAM —á–µ—Ä–µ–∑ `psutil`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ batch size –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –ø–∞–º—è—Ç–∏
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ disk-based –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üîí –ü–∞—Ç—Ç–µ—Ä–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. Sanitization Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –û—á–∏—Å—Ç–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ LLM
**Patterns**:
```python
SANITIZE_PATTERNS = [
    r"(?i)api_key\s*[:=]\s*['\"][^'\"]+['\"]",
    r"(?i)password\s*[:=]\s*['\"][^'\"]+['\"]",
    r"(?i)token\s*[:=]\s*['\"][^'\"]+['\"]",
    r"(?i)secret\s*[:=]\s*['\"][^'\"]+['\"]"
]
```

### 2. Environment-Based Configuration Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
@property
def api_key(self) -> str:
    key = os.getenv(self.api_key_env_var)
    if not key:
        raise ValueError(f"Missing required environment variable: {self.api_key_env_var}")
    return key
```

### 3. Input Validation Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ (–∑–∞—â–∏—Ç–∞ –æ—Ç DoS –∞—Ç–∞–∫)
- Path traversal protection
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
- –°–∞–Ω–∏—Ç–∞–π–∑–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

### 4. Fail-Safe Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏**:
- Fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Sentence-Transformers –ø—Ä–∏ —Å–±–æ–µ FastEmbed)
- Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
- –í–æ–∑–≤—Ä–∞—Ç —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

---

## üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### RAG –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (settings.json):
```json
{
  "rag": {
    "sparse": {
      "method": "SPLADE"
    },
    "embeddings": {
      "provider": "fastembed",
      "model_name": "BAAI/bge-small-en-v1.5",
      "batch_size_max": 512,
      "normalize_embeddings": true
    },
    "vector_store": {
      "host": "localhost",
      "port": 6333,
      "collection_name": "code_chunks",
      "quantization_type": "SQ"
    },
    "query_engine": {
      "max_results": 10,
      "rrf_enabled": true,
      "mmr_enabled": true,
      "cache_ttl_seconds": 300
    }
  }
}
```

### Dataclass –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (config.py):
```python
@dataclass
class EmbeddingConfig:
    provider: str = "fastembed"
    model_name: str = "BAAI/bge-small-en-v1.5"
    batch_size_max: int = 512

@dataclass
class VectorStoreConfig:
    host: str = "localhost"
    port: int = 6333
    quantization_type: str = "SQ"

@dataclass
class QueryEngineConfig:
    max_results: int = 10
    rrf_enabled: bool = True
    mmr_enabled: bool = True
    cache_ttl_seconds: int = 300
```

---

## üèóÔ∏è SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã –≤ —Å–∏—Å—Ç–µ–º–µ

### 1. Single Responsibility Principle (SRP)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –∏–º–µ–µ—Ç –µ–¥–∏–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
**–ü—Ä–∏–º–µ—Ä—ã**:
- `FileScanner` - —Ç–æ–ª—å–∫–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- `CodeChunker` - —Ç–æ–ª—å–∫–æ —Ä–∞–∑–±–∏–≤–∫–∞ –∫–æ–¥–∞
- `CPUEmbedder` - —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

### 2. Open-Closed Principle (OCP)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
**–ü—Ä–∏–º–µ—Ä—ã**:
- –ù–æ–≤—ã–µ –ø–∞—Ä—Å–µ—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç `BaseParser`
- –ù–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ chunking'–∞ —á–µ—Ä–µ–∑ `ChunkingStrategy` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### 3. Liskov Substitution Principle (LSP)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –í–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
**–ü—Ä–∏–º–µ—Ä—ã**:
- –õ—é–±–æ–π `BaseParser` –º–æ–∂–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –¥—Ä—É–≥–æ–π
- `FastEmbedProvider` –∏ `SentenceTransformersProvider` –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã

### 4. Interface Segregation Principle (ISP)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
**–ü—Ä–∏–º–µ—Ä—ã**:
- Separate –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è reading, writing, embedding
- Minimal –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

### 5. Dependency Inversion Principle (DIP)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π, –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
**–ü—Ä–∏–º–µ—Ä—ã**:
- `QueryEngine` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `BaseVectorStore`, –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `RepositoryAnalyzer` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `BaseParser` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (Production SLO):
- **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞**: <300ms p95 (M2 –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫) ‚úÖ
- **–°–∫–æ—Ä–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**: >8 —Ñ–∞–π–ª–æ–≤/—Å–µ–∫ ‚úÖ
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: <700MB –¥–ª—è 1000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚úÖ
- **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –¥–æ 20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚úÖ

### CPU-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- FastEmbed —Å ONNX Runtime
- HNSW –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è CPU (m=24, ef_construct=128)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏ (OMP_NUM_THREADS, torch.set_num_threads)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–∞—Ç—á–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç RAM

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
- LRU –∫—ç—à —Å TTL –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Hit rate >80% –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å–∞

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (5872+ —Å—Ç—Ä–æ–∫)

### Test Categorization Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º —Å pytest –º–∞—Ä–∫–µ—Ä–∞–º–∏
**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏**:
- `unit` - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (59 —Ç–µ—Å—Ç–æ–≤)
- `integration` - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (67 —Ç–µ—Å—Ç–æ–≤)
- `functional` - CLI/subprocess —Ç–µ—Å—Ç—ã (25 —Ç–µ—Å—Ç–æ–≤)
- `e2e` - end-to-end —Å—Ü–µ–Ω–∞—Ä–∏–∏

### Mock Strategy Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ò–∑–æ–ª—è—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö
**Mock –æ–±—ä–µ–∫—Ç—ã**:
- `MockTokenizer` - –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
- `MockSparseModel` - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ sparse –≤–µ–∫—Ç–æ—Ä—ã
- `MockOpenAIClient` - —ç–º—É–ª—è—Ü–∏—è API –±–µ–∑ costs

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:
```
tests/
‚îú‚îÄ‚îÄ test_rag_*.py              # Unit —Ç–µ—Å—Ç—ã RAG –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ rag/                       # –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ RAG —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_rag_integration.py
‚îÇ   ‚îú‚îÄ‚îÄ test_rag_e2e_cli.py
‚îÇ   ‚îî‚îÄ‚îÄ test_rag_performance.py
‚îî‚îÄ‚îÄ fixtures/test_repo/        # 1743 —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### Health Check Pattern
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
```python
def health_check(self) -> dict:
    return {
        "status": "healthy",
        "components": {
            "vector_store": self._check_vector_store(),
            "embedder": self._check_embedder(),
            "openai_api": self._check_openai_api()
        }
    }
```

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (11.09.2025): –†–µ–∞–ª–∏–∑–∞—Ü–∏—è health_check –≤ rag/vector_store.py:
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ `get_cluster_info`.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `get_collections()` ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω –≤–æ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏—è—Ö qdrant-client.
- –ò—Å–∫–ª—é—á–µ–Ω–∞ —Ä–µ–∫—É—Ä—Å–∏—è: –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (gRPC‚ÜîHTTP) –∏ –æ–¥–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞.
- –°—Ç–∞—Ç—É—Å—ã:
  - `status`: `connected` –∏–ª–∏ `error`
  - `collection_status`: `exists` –∏–ª–∏ `not_found`
  - `error`: —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏)
- –§–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ: `self._connected`, `self._collection_exists`.

### –õ–æ–≥–∏—Ä—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–∞/–ø—Ä–æ–µ–∫—Ç–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç
- –ß–∞—Å—Ç–æ—Ç–∞ –∫—ç—à-–ø–æ–ø–∞–¥–∞–Ω–∏–π
- –û—à–∏–±–∫–∏ API –∏ retry —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ú–µ—Ç—Ä–∏–∫–∏ RAG —Å–∏—Å—Ç–µ–º—ã (–ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞, hit rate)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RAG:
```python
from prometheus_client import Counter, Histogram
qdrant_requests_total = Counter("qdrant_requests_total", ["op"])
qdrant_search_latency = Histogram("qdrant_search_latency_seconds")
```

---

## üîÑ CI/CD –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
- **Windows** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Linux** - —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- **macOS** - desktop –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è (–≥–æ—Ç–æ–≤ –∫ M4)

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:
1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ**: pip install + streamlit
2. **Production**: VPS —Å systemd
3. **Enterprise** (M4): Docker-compose —Å Qdrant –∫–ª–∞—Å—Ç–µ—Ä–æ–º

---

## üîÆ –ü–∞—Ç—Ç–µ—Ä–Ω—ã —ç–≤–æ–ª—é—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã

### 1. Feature Flag Pattern (–≥–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
**–§–ª–∞–≥–∏**:
- `enable_sparse_search` - –≤–∫–ª—é—á–µ–Ω–∏–µ sparse –≤–µ–∫—Ç–æ—Ä–æ–≤ (M2 ‚úÖ)
- `enable_advanced_mmr` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π MMR –∞–ª–≥–æ—Ä–∏—Ç–º
- `enable_monitoring` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

### 2. Blue-Green Deployment Pattern (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è M4)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- Parallel Qdrant collections –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- Canary releases –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

### 3. Circuit Breaker Pattern (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤
**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫**:
- OpenAI API –≤—ã–∑–æ–≤–∞–º
- Qdrant —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º  
- –í–Ω–µ—à–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ `repo_sum` –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–æ—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –æ—Å–Ω–æ–≤–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. **–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã**:

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏:
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–æ—Å—Ç
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - CPU-first –ø–æ–¥—Ö–æ–¥ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
- ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - fail-safe –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - plugin architecture –¥–ª—è –Ω–æ–≤—ã—Ö —è–∑—ã–∫–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### M2 –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- ‚úÖ **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω BM25/SPLADE sparse search
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–π RRF** - –Ω–∞—Å—Ç–æ—è—â–∏–π Reciprocal Rank Fusion
- ‚úÖ **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–æ–¥–∞** - —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è camelCase/snake_case

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–≤–∏—Ç–∏—é:
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–æ–∑–¥–∞—é—Ç –ø—Ä–æ—á–Ω—É—é –æ—Å–Ω–æ–≤—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–∏—Ö milestone:
- **M3**: RAG-enhanced –∞–Ω–∞–ª–∏–∑ - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
- **M4**: Production deployment - –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≥–æ—Ç–æ–≤—ã –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é  
- **M5**: Advanced Intelligence - foundation –¥–ª—è ML-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

**–°–∏—Å—Ç–µ–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç industry best practices** –∏ –≥–æ—Ç–æ–≤–∞ –∫ enterprise –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 11 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** Production-Ready Architecture + M2 Hybrid Search  
**–°–ª–µ–¥—É—é—â–∏–π –ø–µ—Ä–µ—Å–º–æ—Ç—Ä:** –ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ M3-M4 milestone
