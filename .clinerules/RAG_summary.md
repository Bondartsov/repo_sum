# RAG –°–∏—Å—Ç–µ–º–∞: –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**–î–∞—Ç–∞:** 15 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** MILESTONE M1.5 –ó–ê–í–ï–†–®–Å–ù ‚úÖ PRODUCTION-READY  
**–í–µ—Ä—Å–∏—è:** 1.5.0

---

## üéØ –°–¢–ê–¢–£–° –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### ‚úÖ –ó–ê–í–ï–†–®–Å–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (14.08.2025)

**RAG —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**

1. **CPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–º–±–µ–¥–¥–µ—Ä** ([`rag/embedder.py`](rag/embedder.py))
   - FastEmbed –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (ONNX Runtime)
   - Sentence Transformers –∫–∞–∫ fallback
   - –ú–æ–¥–µ–ª—å: BAAI/bge-small-en-v1.5 (384 –∏–∑–º–µ—Ä–µ–Ω–∏—è)
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–∞—Ç—á–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏

2. **–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Qdrant** ([`rag/vector_store.py`](rag/vector_store.py))
   - CPU-–ø—Ä–æ—Ñ–∏–ª—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (float16, on_disk, HNSW)
   - –ö–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ: SQ, PQ, BQ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
   - –ë–∞—Ç—á–µ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å retry –ª–æ–≥–∏–∫–æ–π

3. **–ü–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫** ([`rag/query_engine.py`](rag/query_engine.py))
   - RRF (Reciprocal Rank Fusion) –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
   - MMR (Maximum Marginal Relevance) –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
   - LRU –∫—ç—à —Å TTL (300s, 1000 –∑–∞–ø–∏—Å–µ–π)
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ 20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

4. **–°–µ—Ä–≤–∏—Å—ã –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞**
   - [`IndexerService`](rag/indexer_service.py) - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
   - [`SearchService`](rag/search_service.py) - –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

5. **CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ([`main.py`](main.py))
   - `rag index` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
   - `rag search` - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
   - `rag status` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

6. **Web UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ([`web_ui.py`](web_ui.py))
   - –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ "üîç RAG: –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É"
   - Q&A –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ RAG –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏

---

## üèõÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
rag/
‚îú‚îÄ‚îÄ embedder.py         # CPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–º–±–µ–¥–¥–µ—Ä
‚îú‚îÄ‚îÄ vector_store.py     # Qdrant –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ query_engine.py     # –ü–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ —Å RRF/MMR
‚îú‚îÄ‚îÄ indexer_service.py  # –°–µ—Ä–≤–∏—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ search_service.py   # –°–µ—Ä–≤–∏—Å –ø–æ–∏—Å–∫–∞
‚îî‚îÄ‚îÄ exceptions.py       # –°–∏—Å—Ç–µ–º–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **FastEmbed** >= 0.3.6 - –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (ONNX Runtime)
- **Qdrant** >= 1.15.1 - –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ–º
- **–ú–æ–¥–µ–ª—å**: BAAI/bge-small-en-v1.5 (384 –∏–∑–º–µ—Ä–µ–Ω–∏—è)

### CPU-–ø—Ä–æ—Ñ–∏–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **HNSW**: m=16-32, ef_construct=64-128, cosine distance
- **–ö–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ**: Scalar/Product/Binary –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: on-disk —Å mmap –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π
- **–ë–∞—Ç—á–∏**: –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã 8-512 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç RAM

---

## ‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ SLO
- **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞**: <200ms p95
- **–°–∫–æ—Ä–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**: >10 —Ñ–∞–π–ª–æ–≤/—Å–µ–∫
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: <500MB –¥–ª—è 1000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –¥–æ 20 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ê–ª–≥–æ—Ä–∏—Ç–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **RRF (Reciprocal Rank Fusion)** - —Ñ—å—é–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- **MMR (Maximum Marginal Relevance)** - –±–æ—Ä—å–±–∞ —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
- **LRU –∫—ç—à —Å TTL** - –≥–æ—Ä—è—á–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ <200ms
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–∞—Ç—á–∏** - –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π RAM

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (5872+ —Å—Ç—Ä–æ–∫)

### –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–æ–≤
- **Unit —Ç–µ—Å—Ç—ã** ([`tests/test_rag_*.py`](tests/)) - –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** ([`tests/rag/test_rag_integration.py`](tests/rag/test_rag_integration.py)) - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **E2E CLI —Ç–µ—Å—Ç—ã** ([`tests/rag/test_rag_e2e_cli.py`](tests/rag/test_rag_e2e_cli.py)) - –∫–æ–º–∞–Ω–¥—ã –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
- **Performance —Ç–µ—Å—Ç—ã** ([`tests/rag/test_rag_performance.py`](tests/rag/test_rag_performance.py)) - –º–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** ([`tests/fixtures/test_repo/`](tests/fixtures/test_repo/)) - 1743 —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Python –∫–æ–¥–∞
- **–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç** - —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã, SQL –º–æ–¥–µ–ª–∏, —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –í—Å–µ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ CLI –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

---

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –†–ê–ó–í–ò–¢–ò–Æ

### Milestone M2: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–ì–û–¢–û–í –ö –°–¢–ê–†–¢–£)
- **BM25/SPLADE** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è sparse –≤–µ–∫—Ç–æ—Ä–æ–≤
- **–£–ª—É—á—à–µ–Ω–Ω—ã–π RRF** - –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ñ—å—é–∂–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º
- **–ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞** - –ø–æ–≤—ã—à–µ–Ω–∏–µ precision@k –¥–ª—è –∫–æ–¥–∞

### Milestone M3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∞–Ω–∞–ª–∏–∑ (–ì–û–¢–û–í –ö –°–¢–ê–†–¢–£)
- **OpenAIManager** - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö
- **Web UI –ø–æ–∏—Å–∫** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ–∏—Å–∫–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏
- **RAG-enhanced –∞–Ω–∞–ª–∏–∑** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ retrieved –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### Milestone M4: Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å (–ì–û–¢–û–í –ö –°–¢–ê–†–¢–£)
- **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** - –ø–æ–ª–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - Prometheus/Grafana –¥–∞—à–±–æ—Ä–¥—ã —Å –∞–ª–µ—Ä—Ç–∏–Ω–≥–æ–º
- **CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–ø–ª–æ–π

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ settings.json
```json
{
  "rag": {
    "embeddings": {
      "provider": "fastembed",
      "model_name": "BAAI/bge-small-en-v1.5",
      "batch_size_max": 512
    },
    "vector_store": {
      "host": "localhost",
      "port": 6333,
      "quantization_type": "SQ"
    },
    "query_engine": {
      "max_results": 10,
      "rrf_enabled": true,
      "mmr_enabled": true,
      "cache_ttl_seconds": 300
    }
  }
}
```

### Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–õ–æ–∫–∞–ª—å–Ω—ã–π Qdrant** –Ω–∞—Å—Ç—Ä–æ–µ–Ω (10.61.11.54:6333)
- **.env —Ñ–∞–π–ª** –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫**

---

## üí° –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### CLI –∫–æ–º–∞–Ω–¥—ã
```bash
# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
python main.py rag index ./my_project

# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
python main.py rag search "authentication middleware" --lang python --limit 5

# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
python main.py rag status --detailed
```

### Web UI
- –ó–∞–ø—É—Å–∫: `python run_web.py`
- –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ "üîç RAG: –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É"
- Q&A —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å –∫–æ–¥–æ–º
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**RAG —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** —Å 15.08.2025:

‚úÖ **–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã**  
‚úÖ **Web UI –∏ CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞**  
‚úÖ **Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞**  
‚úÖ **5872+ —Å—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å**  
‚úÖ **SLO –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã**  

**–°–ª–µ–¥—É—é—â–∏–µ milestone M2-M4 –≥–æ—Ç–æ–≤—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—á–Ω–æ–≥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞.
